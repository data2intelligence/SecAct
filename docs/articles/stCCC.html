<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Cell-cell communication for single-cell resolution spatial transcriptomics data.
">
<title>Cell-cell communication for single-cell resolution spatial transcriptomics data â€¢ SecAct</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cell-cell communication for single-cell resolution spatial transcriptomics data">
<meta property="og:description" content="Cell-cell communication for single-cell resolution spatial transcriptomics data.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SecAct</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <h6 class="dropdown-header" data-toc-skip>Spatial transcriptomcis (ST) data</h6>
    <a class="dropdown-item" href="../articles/stPattern.html">Signaling patterns and velocities for multi-cellular ST data</a>
    <a class="dropdown-item" href="../articles/stCCC.html">Intercellular communication for single-cell resolution ST data</a>
    <h6 class="dropdown-header" data-toc-skip>Single-cell RNA sequencing data</h6>
    <a class="dropdown-item" href="../articles/scCCC.html">Cell-cell communication mediated by secreted proteins</a>
    <a class="dropdown-item" href="../articles/scState.html">Secreted protein signaling activity for various cell states</a>
    <h6 class="dropdown-header" data-toc-skip>Bulk RNA sequencing data</h6>
    <a class="dropdown-item" href="../articles/bulkDiff.html">Secreted protein activity difference between two phenotypes</a>
    <a class="dropdown-item" href="../articles/bulkCohort.html">Clinical relavance of secreted proteins in a large patient cohort</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/data2intelligence/SecAct/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Cell-cell communication for single-cell resolution spatial transcriptomics data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/data2intelligence/SecAct/blob/HEAD/vignettes/stCCC.Rmd" class="external-link"><code>vignettes/stCCC.Rmd</code></a></small>
      <div class="d-none name"><code>stCCC.Rmd</code></div>
    </div>

    
    
<p>This tutorial demonstrates how to run SecAct to infer cell-cell
communication (CCC) mediated by secreted proteins from single-cell
resolution spatial transcriptomics (ST) data. For this demonstration, we
employ a liver cancer ST
<a href="https://nanostring.com/products/cosmx-spatial-molecular-imager/ffpe-dataset/human-liver-rna-ffpe-dataset/" target="_blank" class="external-link">sample</a>.
Due to the exceptionally large number of cells (~0.5 million) in this
sample, we focus on a subset of regions containing 50,888 cells for
demonstration purposes.</p>
<p>Before running the tutorial, make sure that you have installed SecAct
as well as our previous R package <a href="https://github.com/data2intelligence/SpaCET/" target="_blank" class="external-link">SpaCET</a>, which is an analytical framework for ST
data. Here, SpaCET will be employed to create a SpaCET object to store
the ST data.</p>
<div class="section level2">
<h2 id="read-st-data-to-a-spacet-object">Read ST data to a SpaCET object<a class="anchor" aria-label="anchor" href="#read-st-data-to-a-spacet-object"></a>
</h2>
<p>To load data into R, user can create a SpaCET object by preparing two
types of input data.</p>
<ol style="list-style-type: decimal">
<li>spatial transcriptomics count data. The spatial transcriptomics
count data must be in the format of matrix with gene name (row) x spot
ID (column).</li>
<li>spatial location information. The spot coordinates should be in the
format of matrix with spot ID (row) x coordinates (column). This 1st and
2nd columns represent X and Y coordinates, respectively.</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/data2intelligence/SecAct" class="external-link">SecAct</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/data2intelligence/SpaCET" class="external-link">SpaCET</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dataPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"SecAct"</span><span class="op">)</span>, <span class="st">"extdata/"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataPath</span>,<span class="st">"/LIHC_CosMx_toy.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show count matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span></span>
<span><span class="co">## [1]  1000 50888</span></span>
<span></span>
<span><span class="co"># show coordinate matrix</span></span>
<span><span class="va">spotCoordinates</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">##              x_slide_mm y_slide_mm       cellType</span></span>
<span><span class="co">## c_2_323_101     6.60536    3.32788     Tumor_core</span></span>
<span><span class="co">## c_2_324_367     6.83920    3.10276 Tumor_boundary</span></span>
<span><span class="co">## c_2_324_628     6.92860    3.43312     Tumor_core</span></span>
<span><span class="co">## c_2_324_924     6.82864    3.21076     Tumor_core</span></span>
<span><span class="co">## c_2_325_1167    7.57440    3.14704     Tumor_core</span></span>
<span></span>
<span><span class="co"># load ST data to create an SpaCET object</span></span>
<span><span class="va">SpaCET_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpaCET/man/create.SpaCET.object.html" class="external-link">create.SpaCET.object</a></span><span class="op">(</span></span>
<span>  counts<span class="op">=</span><span class="va">counts</span>,</span>
<span>  spotCoordinates<span class="op">=</span><span class="va">spotCoordinates</span>,</span>
<span>  metaData<span class="op">=</span><span class="va">metaData</span>,</span>
<span>  imagePath<span class="op">=</span><span class="cn">NA</span>,</span>
<span>  platform <span class="op">=</span> <span class="st">"CosMx"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show this object.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">SpaCET_obj</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># show the spatial distribution of all cell types</span></span>
<span><span class="va">my_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">'B'</span><span class="op">=</span><span class="st">'#C88888'</span>,<span class="st">'Erythrocyte'</span><span class="op">=</span><span class="st">'#fe666d'</span>,<span class="st">'T.alpha.beta'</span><span class="op">=</span><span class="st">'#B95FBB'</span>,<span class="st">'T.gamma.delta'</span><span class="op">=</span><span class="st">'#3288bd'</span>,</span>
<span>    <span class="st">'NK'</span><span class="op">=</span><span class="st">'#bb8761'</span>,<span class="st">'Hepatocyte'</span><span class="op">=</span><span class="st">'#63636d'</span>,<span class="st">'Cholangiocyte'</span><span class="op">=</span><span class="st">'#de77ae'</span>,<span class="st">'Endothelial'</span><span class="op">=</span><span class="st">'#D4D915'</span>,</span>
<span>    <span class="st">'Fibroblast'</span><span class="op">=</span><span class="st">'#66c2a5'</span>,<span class="st">'Macrophage'</span><span class="op">=</span><span class="st">'#ff9a36'</span>,<span class="st">'Tumor_core'</span><span class="op">=</span><span class="st">'#A4DFF2'</span>,<span class="st">'Tumor_interface'</span><span class="op">=</span><span class="st">'blue'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpaCET/man/SpaCET.visualize.spatialFeature.html" class="external-link">SpaCET.visualize.spatialFeature</a></span><span class="op">(</span></span>
<span>  <span class="va">SpaCET_obj</span>, </span>
<span>  spatialType <span class="op">=</span> <span class="st">"metaData"</span>, </span>
<span>  spatialFeatures<span class="op">=</span> <span class="st">"cellType"</span>,</span>
<span>  colors <span class="op">=</span> <span class="va">my_cols</span>,</span>
<span>  pointSize <span class="op">=</span> <span class="fl">0.6</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="img/HCC_CoxMx_cellType.png" width="60%" style="border:none"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter out cells with less than 50 expressed genes</span></span>
<span><span class="va">SpaCET_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpaCET/man/SpaCET.quality.control.html" class="external-link">SpaCET.quality.control</a></span><span class="op">(</span><span class="va">SpaCET_obj</span>, min.genes<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the QC metrics</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SpaCET/man/SpaCET.visualize.spatialFeature.html" class="external-link">SpaCET.visualize.spatialFeature</a></span><span class="op">(</span></span>
<span>  <span class="va">SpaCET_obj</span>, </span>
<span>  spatialType <span class="op">=</span> <span class="st">"QualityControl"</span>, </span>
<span>  spatialFeatures<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UMI"</span>,<span class="st">"Gene"</span><span class="op">)</span>,</span>
<span>  imageBg <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="img/HCC_CoxMx_QC.png" width="100%" style="border:none"></p>
</div>
<div class="section level2">
<h2 id="infer-cell-cell-communication">Infer cell-cell communication<a class="anchor" aria-label="anchor" href="#infer-cell-cell-communication"></a>
</h2>
<p>Our strategy performs three steps to infer condition-specific
cell-cell communication: (1) calculating changes in secreted protein
activity for each cell type between two conditions, (2) assessing
changes in secreted protein expression for each cell type between two
conditions, and (3) linking sender and receiver cell types.</p>
<p>When running <code>SecAct.CCC.ST</code>, user need to claim which
column in <code>Seurat_obj@meta.data</code> stores cell-type
annotations. Also, claim which column stores condition information and
what are case and control conditions. All SecAct results are stored in
<code>Seurat_obj @misc $SecAct_output</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># infer activity</span></span>
<span><span class="va">SpaCET_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SecAct.CCC.scST.html">SecAct.CCC.scST</a></span><span class="op">(</span></span>
<span>    <span class="va">SpaCET_obj</span>,</span>
<span>    cellType_meta <span class="op">=</span> <span class="st">"cellType"</span>,</span>
<span>    scale.factor <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    radius <span class="op">=</span> <span class="fl">0.02</span>,</span>
<span>    ratio_cutoff <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    padj_cutoff <span class="op">=</span> <span class="fl">0.01</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">SpaCET_obj</span> <span class="op">@</span><span class="va">results</span> <span class="op">$</span><span class="va">SecAct_output</span><span class="op">)</span></span></code></pre></div>
<p><img src="img/cos1.png" width="50%" style="border:none"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Beibei Ru, Peng Jiang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
