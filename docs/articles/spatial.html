<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Infer secreted protein activity in spatial transcriptomics data.
">
<title>Infer secreted protein activity in spatial transcriptomics data â€¢ SecAct</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Infer secreted protein activity in spatial transcriptomics data">
<meta property="og:description" content="Infer secreted protein activity in spatial transcriptomics data.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SecAct</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../articles/bulk.html">Infer the secreted protein activity from gene expression in bulk level</a>
    <a class="dropdown-item" href="../articles/singleCell.html">Infer the secreted protein activity from single-cell RNA-Seq data</a>
    <a class="dropdown-item" href="../articles/spatial.html">Infer the secreted protein activity from spatial transcriptomics data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/data2intelligence/SecAct/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Infer secreted protein activity in spatial transcriptomics data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/data2intelligence/SecAct/blob/HEAD/vignettes/spatial.Rmd" class="external-link"><code>vignettes/spatial.Rmd</code></a></small>
      <div class="d-none name"><code>spatial.Rmd</code></div>
    </div>

    
    
<p>This tutorial demonstrates how to run SecAct to infer secreted
protein activity and signaling velocity using a spatial transcriptomics
(ST) dataset from endometrial cancer (<a href="https://www.nature.com/articles/s41586-023-06367-z" target="_blank" class="external-link">Paper</a>). Before running the tutorial, make sure that
you have installed SecAct package as well as SpaCET package. The latter
will be employed to create an SpaCET object to store the ST data.</p>
<div class="section level2">
<h2 id="read-st-data-to-an-spacet-object">Read ST data to an SpaCET object<a class="anchor" aria-label="anchor" href="#read-st-data-to-an-spacet-object"></a>
</h2>
<p>This dataset includes two endometrial cancer patients treated with
anti-Netrin-1 (NTN1) compound. Netrin-1 is a secreted glycoprotein that
plays critical roles in angiogenesis and cell survival, and blocking
NTN1 inhibits tumor growth. Each patient has both pre- and on-treatment
tumor samples, respectively. To read ST data into R, user can create an
SpaCET object by using <code>create.SpaCET.object.10X</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/data2intelligence/SpaCET" class="external-link">SpaCET</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set the path to the data folder.</span></span>
<span><span class="va">dataPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"SecAct"</span><span class="op">)</span>, <span class="st">"extdata/"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load ST data to create an SpaCET object.</span></span>
<span><span class="co"># read on-treatment sample</span></span>
<span><span class="va">visiumPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataPath</span>,<span class="st">"UCEC_On/"</span><span class="op">)</span></span>
<span><span class="va">SpaCET_obj_on</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpaCET/man/create.SpaCET.object.10X.html" class="external-link">create.SpaCET.object.10X</a></span><span class="op">(</span>visiumPath <span class="op">=</span> <span class="va">visiumPath</span><span class="op">)</span></span>
<span><span class="va">SpaCET_obj_on</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpaCET/man/SpaCET.quality.control.html" class="external-link">SpaCET.quality.control</a></span><span class="op">(</span><span class="va">SpaCET_obj_on</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read pre-treatment sample</span></span>
<span><span class="va">visiumPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataPath</span>,<span class="st">"UCEC_Pre/"</span><span class="op">)</span></span>
<span><span class="va">SpaCET_obj_pre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpaCET/man/create.SpaCET.object.10X.html" class="external-link">create.SpaCET.object.10X</a></span><span class="op">(</span>visiumPath <span class="op">=</span> <span class="va">visiumPath</span><span class="op">)</span></span>
<span><span class="va">SpaCET_obj_pre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SpaCET/man/SpaCET.quality.control.html" class="external-link">SpaCET.quality.control</a></span><span class="op">(</span><span class="va">SpaCET_obj_pre</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="infer-secreted-protein-activity">Infer secreted protein activity<a class="anchor" aria-label="anchor" href="#infer-secreted-protein-activity"></a>
</h2>
<p>After loading ST data, user can run <code>SecAct.inference</code> to
infer the activities of over 1000 secreted proteins across each spot. Of
note, to analyze the on-treatment sample, the pre-treatment sample will
be set as a control. Then, normalize the expression values of each gene
in the on-treatment sample with the all-spot mean from the pre-treatment
sample.</p>
<p>When analyzing the pre-treatment sample, a control sample is
unavailable. Just normalize the expression values of each gene in the
pre-treatment sample to zero mean across all spots. In other words, you
just regard the same ST sample as a control sample.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># extract count matrix</span></span>
<span><span class="va">expr_on</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">SpaCET_obj_on</span><span class="op">@</span><span class="va">input</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span></span>
<span><span class="va">expr_pre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">SpaCET_obj_pre</span><span class="op">@</span><span class="va">input</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># normalize to TPM</span></span>
<span><span class="va">expr_on</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">expr_on</span><span class="op">)</span><span class="op">*</span><span class="fl">1e6</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">expr_on</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">expr_pre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">expr_pre</span><span class="op">)</span><span class="op">*</span><span class="fl">1e6</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">expr_pre</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># transform to log space</span></span>
<span><span class="va">expr_on</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">expr_on</span><span class="op">/</span><span class="fl">10</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">expr_pre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">expr_pre</span><span class="op">/</span><span class="fl">10</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># normalized with the control samples</span></span>
<span><span class="va">expr_on_rmControl</span> <span class="op">&lt;-</span> <span class="va">expr_on</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">expr_pre</span><span class="op">)</span></span>
<span><span class="va">expr_on_rmControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">expr_on_rmControl</span>,<span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">expr_pre_rmControl</span> <span class="op">&lt;-</span> <span class="va">expr_pre</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">expr_pre</span><span class="op">)</span></span>
<span><span class="va">expr_pre_rmControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">expr_pre_rmControl</span>,<span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run SecAct to infer activity</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/data2intelligence/SecAct" class="external-link">SecAct</a></span><span class="op">)</span></span>
<span><span class="va">res_on</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SecAct.inference.html">SecAct.inference</a></span><span class="op">(</span><span class="va">expr_on_rmControl</span><span class="op">)</span></span>
<span><span class="va">res_pre</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SecAct.inference.html">SecAct.inference</a></span><span class="op">(</span><span class="va">expr_pre_rmControl</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="add-activity-to-spacet-object">Add activity to SpaCET object<a class="anchor" aria-label="anchor" href="#add-activity-to-spacet-object"></a>
</h2>
<p>You can integrate the activity results into the SpaCET object, so
that visiualize them.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">SpaCET_obj_on</span><span class="op">@</span><span class="va">results</span><span class="op">$</span><span class="va">activity</span> <span class="op">&lt;-</span> <span class="va">res_on</span></span>
<span><span class="va">SpaCET_obj_pre</span><span class="op">@</span><span class="va">results</span><span class="op">$</span><span class="va">activity</span> <span class="op">&lt;-</span> <span class="va">res_pre</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SecAct.spatial.velocity.html">SecAct.spatial.velocity</a></span><span class="op">(</span><span class="va">SpaCET_obj_pre</span>, gene <span class="op">=</span> <span class="st">"TGFB1"</span>, signalMode<span class="op">=</span><span class="st">"receiving"</span><span class="op">)</span> </span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SecAct.spatial.velocity.html">SecAct.spatial.velocity</a></span><span class="op">(</span><span class="va">SpaCET_obj_on</span>, gene <span class="op">=</span> <span class="st">"TGFB1"</span>, signalMode<span class="op">=</span><span class="st">"receiving"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">p1</span><span class="op">|</span><span class="va">p2</span></span></code></pre></div>
<p><img src="img/st.png" width="100%" style="border:none"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Beibei Ru, Peng Jiang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
