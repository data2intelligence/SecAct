#!/bin/sh

echo "Checking for GSL..."

if ! command -v gsl-config >/dev/null 2>&1; then
    echo "ERROR: GSL does not appear to be installed."
    echo "Please install GSL first:"
    echo "  macOS: brew install gsl"
    echo "  Ubuntu/Debian: sudo apt-get install libgsl-dev"
    echo "  RedHat/CentOS: sudo yum install gsl-devel"
    echo "  Fedora/RHEL: sudo dnf install gsl-devel"
    echo "  "
    exit 1
fi

GSL_CFLAGS=$(gsl-config --cflags)
GSL_LIBS=$(gsl-config --libs)

if [ -z "$GSL_CFLAGS" ] || [ -z "$GSL_LIBS" ]; then
    echo "ERROR: gsl-config returned empty flags. GSL may be misinstalled."
    exit 1
fi

echo "GSL found!"
echo "  CFLAGS: $GSL_CFLAGS"
echo "  LIBS:   $GSL_LIBS"

mkdir -p src

MAKEVARS=src/Makevars

echo "Generating $MAKEVARS ..."

cat > "$MAKEVARS" <<EOF
## Automatically generated by configure
PKG_CFLAGS = $GSL_CFLAGS
PKG_LIBS = $GSL_LIBS
EOF

echo "Done."
